---
title: "Tenure - EPCs in V10"
author: "Boyana Buyuklieva"
date: "Aug 8, 2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(data.table)
library(fasttime)
library(readxl)

loadRData <- function(fileName){
    #loads an RData file, and returns it
    load(fileName)
    get(ls()[ls() != "fileName"])
}

#get folders
cross_data <- list.files(path = "../Data/RData_crossSectional", pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)

cross_data <- gsub(".RData","",as.character(cross_data))
cross_data <- gsub("crossSectional_","",as.character(cross_data))


#get loopUp
LUT_tenure <- read_excel("../Data/OS-N_EPC_v10_LUT+dictionaries.xlsx", sheet = "TENURE",range = cell_cols("B:C"))
LUT_builtForm <- read_excel("../Data/OS-N_EPC_v10_LUT+dictionaries.xlsx", sheet = "BUILT_FORM",range = cell_cols("B:C"))
#add builing age here
```



```{r loop_template}
LAD_table <- data.table()
start.time <- Sys.time()

for (region in cross_data) {
  print(paste(region, Sys.time()))
  tmp <- loadRData(paste0("../Data/RData_crossSectional/crossSectional_",region,".RData") )
  
  
  for (LA in unique(tmp$LAD11NM)) {
    tmp_LA <- tmp # tmp[ LAD11NM == LA, c('a','b','c')]
    #t_LAD_row <- tmp_LA[,.N ,by = c('x','y','z')]
  }
}

print(paste('loop time:', Sys.time() - start.time))#empty loop runs about 10 mins

if(F){
  save(tmp, file = paste0("../Outputs/WIP_crossSectional/crossSectional_baseline_",region,".RData") )
  write.xlsx(LAD_table,
             file = "../Data/CrossSectional_Summary.xlsx", sheetName="SHEET", append=TRUE)
}

print(paste('save time:', Sys.time() - start.time))
```


```{r loop_data_query}
LAD_table <- data.table()
start.time <- Sys.time()

for (region in cross_data) {
  print(paste(region, Sys.time()))
  tmp <- loadRData(paste0("../Data/RData_crossSectional/crossSectional_",region,".RData") )
  
  
  for (LA in unique(tmp$LAD11NM)) {
    tmp_LA <- tmp # tmp[ LAD11NM == LA, c('a','b','c')]
    #t_LAD_row <- tmp_LA[,.N ,by = c('x','y','z')]
  }
}

print(paste('loop time:', Sys.time() - start.time))#empty loop runs about 10 mins

if(F){
  save(tmp, file = paste0("../Outputs/WIP_crossSectional/crossSectional_baseline_",region,".RData") )
  write.xlsx(LAD_table,
             file = "../Data/CrossSectional_Summary.xlsx", sheetName="SHEET", append=TRUE)
}

print(paste('save time:', Sys.time() - start.time))
```
terms <- rbind(terms,tmp_terms)
}
write.csv(performance, file = './m1xs_performance.csv')
write.csv(terms, file = './m1xs_terms.csv')
View(performance)
summary(tmp_m)
tmp_m <- lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10*x_simp_nn_builtFormXn_propTyp, ordered = F), data = GISRUK_dt)
tmp_m <- lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10:x_simp_nn_builtFormXn_propTyp, ordered = F), data = GISRUK_dt)
summary(tmp_m )
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10:n_tenure, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure:ruc11ind_grp, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure:ruc11ind_grp, ordered = F), data = GISRUK_dt))
View(GISRUK_dt[  is.na(tmp_ruc11ind_grp)])
View(GISRUK_dt[  is.na(ruc11ind_grp)])
summary(GISRUK_dt$ruc11ind_grp)
summarise(GISRUK_dt$ruc11ind_grp)
View(GISRUK_dt$ruc11ind_grp[.N])
View(GISRUK_dt$ruc11ind_grp[,n:= .N])
View(GISRUK_dt$ruc11ind_grp[,n:= .N,])
View(GISRUK_dt$ruc11ind_grp[n:= .N,])
View(GISRUK_dt$ruc11ind_grp[, .N])
GISRUK_dt[ ruc11ind_grp , .N ]
GISRUK_dt[ ruc11ind_grp , .N ,]
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10:ruc11ind_grp, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(GISRUK_dt$ruc11ind_grp)
summary(as.factor(GISRUK_dt$ruc11ind_grp))
which(is.na(GISRUK_dt$ruc11ind_grp))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) + factor(ruc11ind_grp, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(ruc11ind_grp:nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:  0.3187
GISRUK_dt[ , tmp_ruc11ind_grp:= ruc11ind_grp]
GISRUK_dt[ , tmp_ruc11ind_grp:= ruc11ind_grp][ is.nan(ruc11ind_grp), tmp_ruc11ind_grp:= NA][ ruc11ind_grp==Inf, tmp_ruc11ind_grp:= NA]
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(ruc11ind_grp:nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:  0.3187
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) + factor(ruc11ind_grp:nnn_construction_age_band10, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:  0.3187
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) + factor(ruc11ind_grp, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:  0.3187
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F):ruc11ind_grp +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
#easier to read
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + ruc11ind_grp:factor(nnn_construction_age_band10:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) ) ) #Adjusted R-squared: 0.3196
#easier to read
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + ruc11ind_grp:factor(nnn_construction_age_band10:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) , data = GISRUK_dt) ) #Adjusted R-squared: 0.3196
gc()
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + ruc11ind_grp + factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))#Adjusted R-squared:  0.3219
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + ruc11ind_grp:factor(n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + factor(nnn_construction_age_band10, ordered = F) +  factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F) + ruc11ind_grp, data = GISRUK_dt))
#adding interactation terms as separate
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
#adding interactation terms as separate
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) - 1, data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + n_imdRank + ruc11ind_grp + factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
#Add property size
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + RGN11NM:TOTAL_FLOOR_AREA + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
#Add property size
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + TOTAL_FLOOR_AREA + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + RGN11NM:TOTAL_FLOOR_AREA:n_imdRank + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + RGN11NM:TOTAL_FLOOR_AREA + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared: 0.3254 *winner*
#Add property size
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + n_imdRank + RGN11NM:TOTAL_FLOOR_AREA + RGN11NM:n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + RGN11NM:TOTAL_FLOOR_AREA + TOTAL_FLOOR_AREA + n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + n_imdRank + TOTAL_FLOOR_AREA + RGN11NM:TOTAL_FLOOR_AREA + RGN11NM:n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared: 0.3257 *winner 1*
gc()
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + RGN11NM:TOTAL_FLOOR_AREA + RGN11NM:n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared: 0.3257 *winner 1* # check if order matter here. Then add SAP
ggplot(aes( x = TOTAL_FLOOR_AREA ))+
geom_histogram(binwidth = 1)
ggplot(aes( x = TOTAL_FLOOR_AREA ) data = GISRUK)+
ggplot(aes( x = TOTAL_FLOOR_AREA ), data = GISRUK)+
geom_histogram(binwidth = 1)
ggplot(aes( x = TOTAL_FLOOR_AREA ), data = GISRUK_dt)+
geom_histogram(binwidth = 1)
ggplot(aes( y = TOTAL_FLOOR_AREA , x = seq_along(TOTAL_FLOOR_AREA)), data = GISRUK_dt)+
#geom_histogram(binwidth = 1)+
geom_point()
ggplot(aes( x = log(TOTAL_FLOOR_AREA) , data = GISRUK_dt[,.SDcols = TOTAL_FLOOR_AREA])+
ggplot(aes( x = log(TOTAL_FLOOR_AREA) ) , data = GISRUK_dt[,.SDcols = TOTAL_FLOOR_AREA])+
geom_histogram(binwidth = 1)
ggplot(aes( x = log(TOTAL_FLOOR_AREA) ) , data = GISRUK_dt[,.SDcols = TOTAL_FLOOR_AREA])+
ggplot(aes( x = log(TOTAL_FLOOR_AREA) ) , data = GISRUK_dt[,.SDcols = TOTAL_FLOOR_AREA])+
geom_histogram(binwidth = 1)
ggplot(aes( x = log(TOTAL_FLOOR_AREA) ) , data = GISRUK_dt[,.SDcols = TOTAL_FLOOR_AREA])+
geom_histogram(binwidth = .1)
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~  RGN11NM + n_imdRank + RGN11NM:log(TOTAL_FLOOR_AREA) + RGN11NM:n_imdRank + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared: 0.3257
knitr::opts_chunk$set(echo = TRUE)
#does order matter
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ ruc11ind_grp + RGN11NM + n_imdRank + RGN11NM:log(TOTAL_FLOOR_AREA) + RGN11NM:n_imdRank +  ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ n_imdRank + log(TOTAL_FLOOR_AREA) + ruc11ind_grp + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ ruc11ind_grp + n_imdRank + log(TOTAL_FLOOR_AREA) + factor(nnn_construction_age_band10, ordered = F)+  ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt))
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + ruc11ind_grp + n_imdRank + log(TOTAL_FLOOR_AREA) + factor(nnn_construction_age_band10, ordered = F)+  ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F) + ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + ruc11ind_grp + n_imdRank:log(TOTAL_FLOOR_AREA) + ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F)+ RGN11NM:ruc11ind_grp:factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared: 0.3245
gc()
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + ruc11ind_grp + log(TOTAL_FLOOR_AREA) + n_iIoDRank_IDACI +n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA) + ruc11ind_grp:factor(nnn_construction_age_band10:x_simp_nn_builtFormXn_propTyp, ordered = F)+ ruc11ind_grp:RGN11NM:factor(n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
knitr::opts_chunk$set(echo = TRUE)
summary(lm( formula = CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + log(TOTAL_FLOOR_AREA) + x_simp_nn_builtFormXn_propTyp + factor(n_tenure, ordered = F)
+ x_simp_nn_builtFormXn_propTyp:log(TOTAL_FLOOR_AREA)+
+ ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F):log(TOTAL_FLOOR_AREA)
+ factor(nnn_construction_age_band10:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)) #Adjusted R-squared:
gc()
gc()
runtime <- Sys.time()
base_m <-lm( formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + log(TOTAL_FLOOR_AREA) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F)
#two way interactions
+ x_simp_nn_builtFormXn_propTyp:log(TOTAL_FLOOR_AREA) # large homes by type
+ n_iIoDRank_IDACI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band8, ordered = F) #senior's deprivation by house type & size
# interactions with ~20 groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band8, ordered = F):ruc11ind_grp# large homes by type, and urban/rural location
+ factor(nnn_construction_age_band8:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)
GISRUK_dt$nnn_construction_age_band9
runtime <- Sys.time()
base_m <-lm( formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + log(TOTAL_FLOOR_AREA) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F)
#two way interactions
+ x_simp_nn_builtFormXn_propTyp:log(TOTAL_FLOOR_AREA) # large homes by type
+ n_iIoDRank_IDACI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house type & size
# interactions with ~20 groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp# large homes by type, and urban/rural location
+ factor(nnn_construction_age_band8:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)
runtime <- Sys.time()
base_m <-lm( formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + log(TOTAL_FLOOR_AREA) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F)
#two way interactions
+ x_simp_nn_builtFormXn_propTyp:log(TOTAL_FLOOR_AREA) # large homes by type
+ n_iIoDRank_IDACI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house type & size
# interactions with ~20 groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp# large homes by type, and urban/rural location
+ factor(nnn_construction_age_band8:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)
runtime <- Sys.time()
base_m <-lm( formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + log(TOTAL_FLOOR_AREA) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F)
#two way interactions
+ x_simp_nn_builtFormXn_propTyp:log(TOTAL_FLOOR_AREA) # large homes by type
+ n_iIoDRank_IDACI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house type & size
# interactions with ~20 groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp# large homes by type, and urban/rural location
+ factor(nnn_construction_age_band9:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F), data = GISRUK_dt)
rt <-  Sys.time() - runtime
#Adjusted R-squared:
summary(base_m)
rt
runtime <- Sys.time()
base_m <-lm(data = GISRUK_dt,
formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F) + log(TOTAL_FLOOR_AREA)
+ SAP_climate_grp +SAP_version
#two way interactions
+ log(TOTAL_FLOOR_AREA):factor(x_simp_nn_builtFormXn_propTyp, ordered = F) #large homes by type
+ n_iIoDRank_IDACI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house type & size
# interactions with ~20 groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp #large homes by type, and urban/rural location
+ factor(nnn_construction_age_band9:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) )
gc()
runtime <- Sys.time()
base_m <-lm(data = GISRUK_dt,
formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F) + log(TOTAL_FLOOR_AREA)
+ SAP_climate_grp +SAP_version
#two way interactions
+ log(TOTAL_FLOOR_AREA):factor(x_simp_nn_builtFormXn_propTyp, ordered = F) #homes' size by type
+ factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) #homes by type and tenure only
+ n_iIoDRank_IDACI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_iIoDRank_IDACI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house age & size
# interactions with ~20 groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp #homes' size by type, and urban/rural location
+ factor(nnn_construction_age_band9:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) )
rt <-  Sys.time() - runtime
#Adjusted R-squared: 0.33
summary(base_m)
#performance
tmp_performance <- glance(base_m) %>% select(r.squared, adj.r.squared, sigma)
#add info on the residuals
tmp_performance <- cbind(rt, tmp_performance,
'rsd_median' = round(quantile(base_m$residuals)[3],2),
'rsd_Q1' = round(quantile(base_m$residuals)[2],2),
'rsd_Q3' = round(quantile(base_m$residuals)[4],2),
'rt')
tmp_terms <- cbind(tidy(base_m), 'CURRENT_ENERGY_EFFICIENCY ~ RGN11NM + ruc11ind_grp + n_iIoDRank_IDACI
+ factor(nnn_construction_age_band10, ordered = F) + log(TOTAL_FLOOR_AREA) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F)
+ x_simp_nn_builtFormXn_propTyp:log(TOTAL_FLOOR_AREA)+
+ ruc11ind_grp:factor(nnn_construction_age_band10, ordered = F):log(TOTAL_FLOOR_AREA)
+ factor(nnn_construction_age_band10:x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F)' )
library("xlsx")
write.xlsx(tmp_performance, file = "./base_performanc.xlsx",
sheetName = "performance", append = FALSE)
write.xlsx(tmp_terms, file = "./base_performanc.xlsx",
sheetName="terms", append=TRUE)
rt
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(data.table)
library(ggplot2)
library(readr)
library(lme4)
library(jtools)
library(tidyverse)
library(broom)
source("../Outputs/Thesis_custom_scripts.R", local = knitr::knit_global())
NS_dt <- loadRData( "../Data/RData_crossSectional/_NS_dt_N14m152777.RData")
#-#Add the regions groups!!!
#ggplot( NS_dt, aes( colour = .., x = n_imdRank, y = CURRENT_ENERGY_EFFICIENCY )) +
#  geom_smooth(method = 'lm')
cols <- read.csv("../Data/RData_crossSectional/combi_SC_dt_cols_2023_0105.csv")
GISRUK_dt <- NS_dt[, .SDcols= cols]
cols[cols$GISRUK == 1]
cols[cols$GISRUK == 1,]
cols$name[cols$GISRUK == 1]
cols$name[!is.na(cols$GISRUK)]
GISRUK_dt <- NS_dt[, .SDcols=cols$name[!is.na(cols$GISRUK)]]
GISRUK_dt <- NS_dt[ ,, .SDcols=cols$name[!is.na(cols$GISRUK)]]
c( cols$name[!is.na(cols$GISRUK)])
GISRUK_dt <- NS_dt[ ,, ..cols$name[!is.na(cols$GISRUK)]]
GISRUK_dt <- NS_dt[ ,..cols$name[!is.na(cols$GISRUK)]]
GISRUK_dt <- NS_dt[ ,cols$name[!is.na(cols$GISRUK)]]
GISRUK_dt <- NS_dt[ , .SD, .SDcols = cols$name[!is.na(cols$GISRUK)] ]
#subset vars to fit from csv
cols <- read.csv("../Data/RData_crossSectional/combi_SC_dt_cols_2023_0105.csv")
GISRUK_dt <- NS_dt[ , .SD, .SDcols = cols$name[!is.na(cols$GISRUK)] ]
runtime <- Sys.time()
base_m <-lm(data = GISRUK_dt,
formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_jIoDRank_IDAOPI
+ factor(nnn_construction_age_band10, ordered = F) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F) + log(TOTAL_FLOOR_AREA)
+ SAP_climate_grp +SAP_version
#two way interactions
+ log(TOTAL_FLOOR_AREA):factor(x_simp_nn_builtFormXn_propTyp, ordered = F) #homes' size by type
+ factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) #homes by type and tenure only
+ n_jIoDRank_IDAOPI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_jIoDRank_IDAOPI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house age & size
# interactions with ~20+ groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp #homes' size by type, and urban/rural location
+ factor(x_simp_nn_builtFormXn_propTyp:nnn_construction_age_band9:n_tenure, ordered = F) )
#subset vars to fit from csv
cols <- read.csv("../Data/RData_crossSectional/combi_SC_dt_cols_2023_0105.csv")
GISRUK_dt <- NS_dt[ , .SD, .SDcols = cols$name[!is.na(cols$GISRUK)] ]
runtime <- Sys.time()
base_m <-lm(data = GISRUK_dt,
formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_jIoDRank_IDAOPI
+ factor(nnn_construction_age_band10, ordered = F) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F) + log(TOTAL_FLOOR_AREA)
+ SAP_climate_grp +SAP_version
#two way interactions
+ log(TOTAL_FLOOR_AREA):factor(x_simp_nn_builtFormXn_propTyp, ordered = F) #homes' size by type
+ factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) #homes by type and tenure only
+ n_jIoDRank_IDAOPI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_jIoDRank_IDAOPI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house age & size
# interactions with ~20+ groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp #homes' size by type, and urban/rural location
+ factor(x_simp_nn_builtFormXn_propTyp:nnn_construction_age_band9:n_tenure, ordered = F) )
#subset vars to fit from csv
cols <- read.csv("../Data/RData_crossSectional/combi_SC_dt_cols_2023_0105.csv")
GISRUK_dt <- NS_dt[ , .SD, .SDcols = cols$name[!is.na(cols$GISRUK)] ]
runtime <- Sys.time()
base_m <-lm(data = GISRUK_dt,
formula = CURRENT_ENERGY_EFFICIENCY ~
#single variables
RGN11NM + ruc11ind_grp + n_jIoDRank_IDAOPI
+ factor(nnn_construction_age_band10, ordered = F) + factor(x_simp_nn_builtFormXn_propTyp, ordered = F) + factor(n_tenure, ordered = F) + log(TOTAL_FLOOR_AREA)
+ SAP_climate_grp +SAP_version
#two way interactions
+ log(TOTAL_FLOOR_AREA):factor(x_simp_nn_builtFormXn_propTyp, ordered = F) #homes' size by type
+ factor(x_simp_nn_builtFormXn_propTyp:n_tenure, ordered = F) #homes by type and tenure only
+ n_jIoDRank_IDAOPI:factor(nnn_construction_age_band10, ordered = F) #senior's deprivation by house type
#three way interactions
+ n_jIoDRank_IDAOPI:log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F) #senior's deprivation by house age & size
# interactions with ~20+ groups
+ log(TOTAL_FLOOR_AREA):factor(nnn_construction_age_band9, ordered = F):ruc11ind_grp #homes' size by type, and urban/rural location
+ factor(x_simp_nn_builtFormXn_propTyp:nnn_construction_age_band9:n_tenure, ordered = F) )
rt <-  Sys.time() - runtime
#Adjusted R-squared:
summary(base_m)
#remove ordering
test <- GISRUK_dt[1:100,]
test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)})]
test[ , lapply(., function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)})]
test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)}), by =.]
test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)}), by = .SD]
test <- test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)}), by = .SD]
#remove ordering
test <- GISRUK_dt[1:100,]
test <- test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, x = factor(x, ordered = F), x = x)}), by = .SD]
#remove ordering
test <- GISRUK_dt[1:100,]
test <- test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, x = factor(x, ordered = F), x = x)}), by = .SD]
test <- test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)}), by = .SD]
View(test)
#remove ordering
test <- GISRUK_dt[1:100,]
View(test)
test <- test[ , lapply(.SD, function(x){ifelse(is.ordered(x) == T, factor(x, ordered = F), x)}), by = by = seq_len(nrow(test))]
#remove ordering
remove_order <- names(GISRUK_dt)[is.ordered(GISRUK_dt)]
remove_order
is.ordered(GISRUK_dt)
lapply(GISRUK_dt, is.ordered(x))
lapply(GISRUK_dt, is.ordered
)
#remove ordering
remove_order <- names(GISRUK_dt)[lapply(GISRUK_dt, is.ordered)]
#remove ordering
remove_order <- names(GISRUK_dt)[sapply(GISRUK_dt, is.ordered)]
remove_order
test <- GISRUK_dt[  lapply(.SD, function(x) factor(x, ordered = F)),.SDcols = remove_order]
test <- GISRUK_dt[  (remove_order) := lapply(.SD, function(x) factor(x, ordered = F)), .SDcols = remove_order]
test <- GISRUK_dt[  ,(remove_order) := lapply(.SD, function(x) factor(x, ordered = F)), .SDcols = remove_order]
grep(names(GISRUK_dt),'Rank')
grep('Rank',names(GISRUK_dt))
ranks <- names(GISRUK_dt)[grep('Rank',names(GISRUK_dt))]
ranks
gsub('Rank', 'Percent', ranks)
rm(test)
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) x/max(x)), .SDcols = rank_names]
#‘percentage’ measure rather than the ‘rank’ measure
rank_names <- names(GISRUK_dt)[grep('Rank',names(GISRUK_dt))]
percent_names <- gsub('Rank', 'Percent', rank_names)
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) x/max(x)), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
rm(test)
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
test <- GISRUK_dt[ , (rank_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
rm(test)
test <- GISRUK_dt[ , (rank_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
#‘percentage’ measure rather than the ‘rank’ measure
rank_names <- names(GISRUK_dt)[grep('Rank',names(GISRUK_dt))]
percent_names <- gsub('Rank', 'Percent', rank_names)
test <- GISRUK_dt[ , (rank_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
names(test)
rm(test)
test <- GISRUK_dt[ , (rank_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
test <- GISRUK_dt[ , (rank_names):= lapply(.SD, function(x) 3), .SDcols = rank_names]
rank_names
rm(test)
names(GISRUK_dt)
#subset vars to fit from csv
cols <- read.csv("../Data/RData_crossSectional/combi_SC_dt_cols_2023_0105.csv")
GISRUK_dt <- NS_dt[ , .SD, .SDcols = cols$name[!is.na(cols$GISRUK)] ]
#remove ordering
remove_order <- names(GISRUK_dt)[sapply(GISRUK_dt, is.ordered)]
GISRUK_dt <- GISRUK_dt[ ,
(remove_order) := lapply(.SD, function(x) factor(x, ordered = F)),
.SDcols = remove_order]
#‘percentage’ measure rather than the ‘rank’ measure
rank_names <- names(GISRUK_dt)[grep('Rank',names(GISRUK_dt))]
percent_names <- gsub('Rank', 'Percent', rank_names)
test <- GISRUK_dt[ , (rank_names):= lapply(.SD, function(x) 3), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) x/max(x)), .SDcols = rank_names]
rm(test)
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) x/max(x)), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
View(test)
gc()
rm(test)
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) prop.table(x)), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) max(x)), .SDcols = rank_names]
head(test [, .SDcols = rank_names])
head(test [,, .SDcols = rank_names])
head(test [,, rank_names])
head(test [,rank_names])
head(test [,..rank_names])
col = rank_names[1]
max <- max(GISRUK_dt[,.SDcols = col])
GISRUK_dt[ 1:5 , , .SDcols = rank_names]
rm(list = ls())
GISRUK_dt[ 1:5 , , ..rank_names]
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(data.table)
library(ggplot2)
library(readr)
library(lme4)
library(jtools)
library(tidyverse)
library(broom)
source("../Outputs/Thesis_custom_scripts.R", local = knitr::knit_global())
NS_dt <- loadRData( "../Data/RData_crossSectional/_NS_dt_N14m152777.RData")
#subset vars to fit from csv
cols <- read.csv("../Data/RData_crossSectional/combi_SC_dt_cols_2023_0105.csv")
GISRUK_dt <- NS_dt[ , .SD, .SDcols = cols$name[!is.na(cols$GISRUK)] ]
#remove ordering
remove_order <- names(GISRUK_dt)[sapply(GISRUK_dt, is.ordered)]
GISRUK_dt <- GISRUK_dt[ ,
(remove_order) := lapply(.SD, function(x) factor(x, ordered = F)),
.SDcols = remove_order]
gc()
#‘percentage’ measure rather than the ‘rank’ measure
rank_names <- names(GISRUK_dt)[grep('Rank',names(GISRUK_dt))]
percent_names <- gsub('Rank', 'Percent', rank_names)
GISRUK_dt[ 1:5 , , rank_names]
GISRUK_dt[ 1:5 , .SDcols = rank_names]
GISRUK_dt[ 1:5 , ..rank_names]
test <- GISRUK_dt[ 1:5 , (percent_names):= apply(.SD, 2, function(x) x/max(x) ), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= apply(.SD, 2, function(x) x/max(x) ), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= max(rank_names), .SDcols = rank_names]
test[ 1:5 , ..rank_names]
test <- GISRUK_dt[ , (percent_names):= max(rank_names)]
test[ 1:5 , ..rank_names]
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, max), .SDcols = rank_names]
test[ 1:5 , ..rank_names]
test[ 1:5 , ..percent_names]
test <- GISRUK_dt[ , (percent_names):= max(rank_names), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= max(rank_names)]
test[ 1:5 , ..percent_names]
test <- GISRUK_dt[ , (percent_names):= max(.SD), .SDcols = rank_names]
test[ 1:5 , ..percent_names]
View(test[ 1:5 , ..rank_names[1]])
GISRUK_dt[, ..rank_names[1]]
GISRUK_dt[, "n_iIoDRank_IDACI"]
max(GISRUK_dt[, "n_iIoDRank_IDACI"])
max(GISRUK_dt[, "n_iIoDRank_IDACI"], na.rm = T)
View(GISRUK_dt[ is.na(n_iIoDRank_IDACI),])
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(data.table)
library(ggplot2)
library(readr)
library(lme4)
library(jtools)
library(tidyverse)
library(broom)
source("../Outputs/Thesis_custom_scripts.R", local = knitr::knit_global())
NS_dt <- loadRData( "../Data/RData_crossSectional/_NS_dt_N14m152777.RData")
GISRUK_dt <- GISRUK_dt[!is.na(NS_dt$n_imdRank),]# n = 12 973 980 (due to IMD)
GISRUK_dt <- GISRUK_dt[!RGN11NM == 'Wales',] # n = 12 973 960 (excluding Wales) / now drops = 40
GISRUK_dt <- GISRUK_dt[!CURRENT_ENERGY_EFFICIENCY == 1,] # n = 12 957 835 / now drops = 16 125
rm(na, NS_dt)
#remove ordering in factors
remove_order <- names(GISRUK_dt)[sapply(GISRUK_dt, is.ordered)]
GISRUK_dt <- GISRUK_dt[ ,
(remove_order) := lapply(.SD, function(x) factor(x, ordered = F)),
.SDcols = remove_order]
#‘percentage’ measure rather than the ‘rank’ measure
rank_names <- names(GISRUK_dt)[grep('Rank',names(GISRUK_dt))]
percent_names <- gsub('Rank', 'Percent', rank_names)
rank_names
sum(is.na(GISRUK_dt[,"n_jIoDRank_IDAOPI"]))
test <- GISRUK_dt[ , (percent_names):= apply(.SD, 2, function(x) x/max(x, na.rm = T) ), .SDcols = rank_names]
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) x/max(x)), .SDcols = rank_names]
sum(GISRUK_dt[,"n_jIoDRank_IDAOPI"])
sum(GISRUK_dt[,"n_jIoDPercent_IDAOPI"])
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) rank(x)/length(x)), .SDcols = rank_names]
View(GISRUK_dt[ order(percent_names), 1:10 , c(rank_names,percent_names) )
View(GISRUK_dt[ order(percent_names), 1:10 , c(rank_names,percent_names) ])
percent_names
View(test[ order(percent_names), 1:10 , c(rank_names,percent_names) ])
View(test[ order(percent_names), 1:10 , ..c(rank_names,percent_names)  ])
View(test[ order(percent_names), 1:10 , .SDcols = c(rank_names,percent_names)  ])
View(test[ order(percent_names), 1:10 ,  c(rank_names,percent_names), with=FALSE  ])
View(test[ order(percent_names), 1:10 ][,c(rank_names,percent_names)])
View(test[ order(percent_names), 1:10 ][,..c(rank_names,percent_names)])
View(test[ order(percent_names), 1:10 ][, .SD, .SDcols = c(rank_names,percent_names)])
test <- GISRUK_dt[ , (percent_names):= lapply(.SD, function(x) rank(x)/length(x)), .SDcols = rank_names]
View(test[ order(percent_names), 1:10 ][, .SD, .SDcols = c(rank_names,percent_names)])
View(test[ , 1:10 , c(rank_names,percent_names)])
head(test$n_imdPercent)
head(test$n_imdPercent,test$n_imdPercent)
head(test$n_imdPercent,test$n_imdRank)
head(c(test$n_imdPercent,test$n_imdRank))
head(test$n_imdRank)
quantile(test$n_imdRank,0.5161525)
quantile(test$n_imdRank,0.8194468)
percent_names
#log tranformation
GISRUK_dt[ , 'log(tf_area)' := log(TOTAL_FLOOR_AREA)]
levels(RGN11NM)
levels(GISRUK$RGN11NM)
levels(GISRUK_dt$RGN11NM)
unique(GISRUK_dt$RGN11NM)
View(GISRUK_dt[RGN11NM == "_Unknown-Local-Authority",])
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(data.table)
library(ggplot2)
library(readr)
library(lme4)
library(jtools)
library(tidyverse)
library(broom)
library(broom.mixed)
#library(broomExtra)
source("../Outputs/Thesis_custom_scripts.R", local = knitr::knit_global())
NS_dt <- loadRData( "../Data/RData_crossSectional/_NS_dt_N14m152777.RData")

---
title: "Time_Descriptives"
author: "Boyana Buyuklieva"
date: "August 1, 2022"
output: html_document
---

Note: previously named 4_temporal descriptives

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(data.table)
library(fasttime)

loadRData <- function(fileName){
    #loads an RData file, and returns it
    load(fileName)
    get(ls()[ls() != "fileName"])
}


#get folders
WIP_dt <- list.files(path = "../Outputs/WIP_longitudinal", pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)

#move London to the back
regions <- WIP_dt[c(1,2,c(seq(4,11,by=1)),3)]
regions <- gsub(".RData","",as.character(regions))
regions <- gsub("longitudinal_baseline_","",as.character(regions))

if(F){
  raw_dt <- list.files(path = "../Data/RData_longitudinal", pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)}
```





#Counting on RData Directory
```{r loop_template_example}
start.time <- Sys.time()

#long_data <- long_data[1] #testing
for (region in long_data) {
  print(region)
  
  tmp_raw <- loadRData(paste0("../Data/RData_longitudinal/",region) )
  tmp_WIP <- loadRData(paste0("../Outputs/WIP_longitudinal/longitudinal_baseline_",region,".RData") )
  
  #for(LA in unique(tmp_region_dt[, LAD11NM])[1:5] ){#testing
  for(LA in unique(tmp_region_dt[, LAD11NM]) ){  
    
    print_counter = print_counter+1
    if(print_counter %% 20 == 0){print(LA)} 
  }
  print(paste('LAD loop completed:', Sys.time() - start.time))
}
print(paste('LAD loop completed:', Sys.time() - start.time))

if(F)
{
  save(x, file = paste0("../Outputs/WIP_longitudinal/longitudinal_baseline_",region,".RData") )
  write.xlsx(x,
             file = "../Data/LAD_CrossSectional_Summary.xlsx", sheetName="SHEET", append=TRUE)}

print(paste('runtime:', Sys.time() - start.time))
```





#Quick Checks
```{r loop_uniqueGRPs}
LAD_table <- list()

for(region in regions){
  print(paste(region, Sys.time()))

  #tmp_tally <- loadRData(paste0("../Outputs/WIP_longitudinal/longitudinal_baseline_",region,".RData") )
  
  LADrows <- tmp_tally[,length(unique(n_GRP)), by = c('LAD11NM')]
  LADrows$region <- region
  
  LAD_table <- rbind(LAD_table,LADrows)
}

names(LAD_table) <- c("LAD11NM","N_unique_GRPs","region")
LAD_table <- LAD_table[,c("region","LAD11NM","N_unique_GRPs")]
LAD_table$N_unique_GRPs <- as.numeric(LAD_table$N_unique_GRPs)

write.xlsx(LAD_table,
             file = "../Data/LAD_Longitudinal_Summary.xlsx", sheetName="uniqueGRPs", append=TRUE)
```









---
title: "Time_Descriptives"
author: "Boyana Buyuklieva"
date: "May 24, 2022"
output: html_document
---

Note: previously named 4_temporal descriptives

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(data.table)
library(fasttime)

loadRData <- function(fileName){
    #loads an RData file, and returns it
    load(fileName)
    get(ls()[ls() != "fileName"])
}

#get folders
WIP_dt <- list.files(path = "../Outputs/WIP_longitudinal", pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)

#move London to the back
regions <- WIP_dt[c(1,2,c(seq(4,11,by=1)),3)]
regions <- gsub(".RData","",as.character(regions))
regions <- gsub("long_LAD_tally_","",as.character(regions))
```

```{r loop_uniqueGRPs}
LAD_table <- list()

for(region in regions){
  print(paste(region, Sys.time()))
  tmp_tally <- loadRData(paste0("../Outputs/WIP_longitudinal/long_LAD_tally_",region,".RData") )
  LADrows <- tmp_tally[,length(unique(n_GRP)), by = c('LAD11NM')]
  LADrows$region <- region
  LAD_table <- rbind(LAD_table,LADrows)
}

names(LAD_table) <- c("LAD11NM","N_unique_GRPs","region")
LAD_table <- LAD_table[,c("region","LAD11NM","N_unique_GRPs")]
LAD_table$N_unique_GRPs <- as.numeric(LAD_table$N_unique_GRPs)

write.xlsx(LAD_table,
             file = "../Data/LAD_Longitudinal_Summary.xlsx", sheetName="uniqueGRPs", append=TRUE)
   
   
```



```{r loop_uniqueGRPs}
LAD_table <- list()

for(region in regions){
  print(paste(region, Sys.time()))
  tmp_tally <- loadRData(paste0("../Outputs/WIP_longitudinal/long_LAD_tally_",region,".RData") )
  LADrows <- tmp_tally[,length(unique(n_GRP)), by = c('LAD11NM')]
  LADrows$region <- region
  
  
  
  LAD_table <- rbind(LAD_table,LADrows)
}

names(LAD_table) <- c("LAD11NM","N_unique_GRPs","region")
LAD_table <- LAD_table[,c("region","LAD11NM","N_unique_GRPs")]
LAD_table$N_unique_GRPs <- as.numeric(LAD_table$N_unique_GRPs)

write.xlsx(LAD_table,
             file = "../Data/LAD_Longitudinal_Summary.xlsx", sheetName="uniqueGRPs", append=TRUE)
```

```{r loop_noUPRN}
LAD_table <- list()

for(region in regions){
  print(paste(region, Sys.time()))
  tmp_tally <- loadRData(paste0("../Outputs/WIP_longitudinal/long_LAD_tally_",region,".RData") )
  LADrows <- tmp_tally[n_erNoUPRN ==  "noUPRN",.N, by = c('LAD11NM', 'n_GRP')]
  LADrows$region <- region
  
  
  
  LAD_table <- rbind(LAD_table,LADrows)
}

names(LAD_table) <- c("LAD11NM","n_erNoUPRN=N_noUPRN","region")
LAD_table <- LAD_table[,c("region","LAD11NM","n_erNoUPRN=N_noUPRN")]
LAD_table$N_unique_GRPs <- as.numeric(LAD_table$N_unique_GRPs)

write.xlsx(LAD_table,
             file = "../Data/LAD_Longitudinal_Summary.xlsx", sheetName="noUPRN", append=TRUE)
```


```{r testing}
tmp_skinny <- loadRData(paste0("../Outputs/WIP_longitudinal/long_LAD_tally_",region,".RData") ) 

LAD_table <- list()

for(region in regions)
    print(paste(region, Sys.time()))

region <- regions[3]

print()
tmp_tally <- loadRData(paste0("../Outputs/WIP_longitudinal/long_LAD_tally_",region,".RData") )


LADrows <- tmp_tally[,length(unique(n_GRP)), by = c('LAD11NM')]
LADrows$region <- region


LAD_table <- rbind(LADrows,LADrows)


```






